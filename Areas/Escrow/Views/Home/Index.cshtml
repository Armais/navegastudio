@{
    ViewData["Title"] = "Peer Escrow";
    var isDemoMode = (bool)(ViewBag.IsDemoMode ?? true);
}

@section Styles {
    <link rel="stylesheet" href="~/css/escrow.css" asp-append-version="true" />
}

<div class="peer-escrow">
    <!-- Hero -->
    <section class="pe-hero text-center">
        <div class="container">
            <h1 class="display-4 fw-bold mb-3">
                Peer-to-Peer <span class="text-accent">Escrow</span>
            </h1>
            <p class="lead pe-text-muted mb-4" style="max-width: 700px; margin: 0 auto;">
                Trustless payments powered by Ethereum smart contracts.
                Funds are locked until both parties agree &mdash; with optional arbiter dispute resolution.
            </p>
            <div class="d-flex justify-content-center gap-3">
                <a asp-area="Escrow" asp-controller="Home" asp-action="Dashboard" class="btn btn-primary btn-lg px-4">
                    Launch App
                </a>
                <a href="#how-it-works" class="btn btn-outline-secondary btn-lg px-4">
                    How It Works
                </a>
            </div>
            @if (isDemoMode)
            {
                <div class="alert alert-warning d-inline-block mt-4 mb-0">
                    <strong>Demo Mode:</strong> No blockchain required. Try the full escrow flow locally.
                </div>
            }
        </div>
    </section>

    <!-- How It Works -->
    <section id="how-it-works" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">How It Works</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card h-100 text-center">
                        <div class="card-body">
                            <div class="display-5 mb-3 text-accent">1</div>
                            <h5>Create &amp; Fund</h5>
                            <p class="pe-text-muted">Buyer creates an escrow specifying seller, arbiter, and amount. ETH is locked in the smart contract.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 text-center">
                        <div class="card-body">
                            <div class="display-5 mb-3 text-accent">2</div>
                            <h5>Ship &amp; Deliver</h5>
                            <p class="pe-text-muted">Seller confirms shipment or service delivery. Both parties can raise a dispute if something goes wrong.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 text-center">
                        <div class="card-body">
                            <div class="display-5 mb-3 text-accent">3</div>
                            <h5>Confirm &amp; Release</h5>
                            <p class="pe-text-muted">Buyer confirms receipt. Funds are released to seller minus arbiter fee. Disputes are resolved by the arbiter.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- State Machine -->
    <section class="py-5 pe-state-section">
        <div class="container">
            <h2 class="text-center mb-4">Escrow State Machine</h2>
            <div class="text-center">
                <div class="d-inline-flex flex-wrap justify-content-center align-items-center gap-2" style="font-family: monospace; font-size: 0.9rem;">
                    <span class="badge bg-primary px-3 py-2">Funded</span>
                    <span class="pe-text-muted">&rarr;</span>
                    <span class="badge bg-warning text-dark px-3 py-2">Shipped</span>
                    <span class="pe-text-muted">&rarr;</span>
                    <span class="badge bg-success px-3 py-2">Completed</span>
                </div>
                <div class="mt-3 pe-text-muted small">
                    <span class="badge bg-primary px-2">Funded</span> / <span class="badge bg-warning text-dark px-2">Shipped</span>
                    <span>&rarr;</span>
                    <span class="badge bg-danger px-2">Disputed</span>
                    <span>&rarr;</span>
                    <span class="badge bg-info px-2">Resolved</span>
                    &nbsp;|&nbsp;
                    <span class="badge bg-primary px-2">Funded</span>
                    <span>&rarr;</span>
                    <span class="badge bg-dark px-2">Cancelled</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Features -->
    <section class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">Features</h2>
            <div class="row g-4">
                <div class="col-md-3 col-6">
                    <div class="text-center">
                        <div class="fs-1 mb-2">&#128274;</div>
                        <h6>Non-Custodial</h6>
                        <small class="pe-text-muted">Funds held by smart contract, not a middleman</small>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="text-center">
                        <div class="fs-1 mb-2">&#9878;</div>
                        <h6>Arbiter System</h6>
                        <small class="pe-text-muted">Neutral third-party resolves disputes with configurable split</small>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="text-center">
                        <div class="fs-1 mb-2">&#128200;</div>
                        <h6>Full Transparency</h6>
                        <small class="pe-text-muted">Every action recorded on-chain with event logs</small>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="text-center">
                        <div class="fs-1 mb-2">&#128187;</div>
                        <h6>Demo Mode</h6>
                        <small class="pe-text-muted">Try the full flow without MetaMask or testnet ETH</small>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA -->
    <section class="py-5 text-center pe-cta-section">
        <div class="container">
            <h3 class="mb-3">Ready to try it?</h3>
            <p class="pe-text-muted mb-4">No signup needed. Connect your wallet or use demo mode.</p>
            <a asp-area="Escrow" asp-controller="Home" asp-action="Dashboard" class="btn btn-primary btn-lg px-5">
                Open Dashboard
            </a>
        </div>
    </section>
</div>
